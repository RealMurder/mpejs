<!doctype html>
<html>
<head>
  <meta charset='utf-8' />
  <title>mpe.js</title>
  <meta name='description' content='Next Generation MIDI for the Web'>
  <meta name='keywords' content='MIDI,MPE,JavaScript,node.js'>
  <meta name='author' content='ROLI'>
  <meta property='og:title' content='mpe.js'/>
  <meta property='og:description' content='Next Generation MIDI for the Web'/>
  <meta property='og:image' content='https://d30pueezughrda.cloudfront.net/mpe.js/mpe-og-image.jpg'/>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <link href='https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400italic,500|Fira+Mono' rel='stylesheet' type='text/css'>
  <link href='assets/bass.css' type='text/css' rel='stylesheet' />
  <link href='assets/style.css' type='text/css' rel='stylesheet' />
  <link href='assets/github.css' type='text/css' rel='stylesheet' />
  <!--[if IE] <link rel="shortcut icon" href="assets/favicon-16.ico" /> -->
  <link href="assets/favicon-16.png" rel="icon" sizes="16x16" type="image/png" />
  <link href="assets/favicon-32.png" rel="icon" sizes="32x32" type="image/png" />
  <link href="assets/favicon-64.png" rel="icon" sizes="64x64" type="image/png" />
  <link href="assets/favicon-180.png" rel="icon" sizes="180x180" type="image/png" />
  <link href="assets/favicon-57.png" rel="apple-touch-icon" sizes="57x57" />
  <link href="assets/favicon-72.png" rel="apple-touch-icon" sizes="72x72" />
  <link href="assets/favicon-114.png" rel="apple-touch-icon" sizes="114x114" />
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>
<body class='documentation fill-light'>
  <div class='max-width-4 mx-auto'>
    <nav class='px2 relative'>
      <img src="assets/roli-monogram.svg" alt="mpe.js" class="logo" />
      <div style='position: absolute; z-index: 2; right: 135px; top: 10px; opacity: 0.98;'>
        <div class='fixed'>
          <a style='display: none;' class='github-button' href='https://github.com/weareroli/mpejs' data-icon='octicon-star' data-style='mega' data-count-href='/weareroli/mpejs/stargazers' data-show-count='true' data-count-aria-label='# stargazers on GitHub' aria-label='Star weareroli/mpejs on GitHub'>Star</a>
        </div>
      </div>
      <div class='blur' />
    </nav>
    <div class='clearfix md-mxn2 mt3'>
      <div class='fixed sm-hide xs-hide fix-3 overflow-auto max-height-100'>
        <div class='pl2 pb4'>
          <h1 class='library-name stroke-light rounded p1'>
            <small class="right">
              <a class='black' href="https://github.com/WeAreROLI/mpejs/commits/master">
                1.0.0
              </a>
            </small>
            <a class='black' href='https://github.com/WeAreROLI/mpejs'>
              mpe.js
              <br><small class='quiet'>View on GitHub</small>
            </a>
          </h1>
          <div id='toc' class='mt1 ml1'>
            <ul class='list-reset h5'>
              
                
                <li class="mt1">
                  <a
                    href='#Installation'
                    class="block bold black caps">
                    Installation
                  </a>
                
                </li>
              
                
                <li class="mt1">
                  <a
                    href='#Quick start'
                    class="block bold black caps">
                    Quick start
                  </a>
                
                </li>
              
                
                <li class="mt1">
                  <a
                    href='#API'
                    class="block bold black caps">
                    API
                  </a>
                
                </li>
              
                
                <li class="ml1 mb2">
                  <a
                    href='#mpeInstrument'
                    class="block code">
                    mpeInstrument
                  </a>
                
                <div>
                  
                  
                    <ul class='list-reset'>
                      
                      <li><a
                        href='#mpeInstrument#activeNotes'
                        class='regular pre-open code'>
                        #activeNotes
                      </a></li>
                      
                      <li><a
                        href='#mpeInstrument#clear'
                        class='regular pre-open code'>
                        #clear
                      </a></li>
                      
                      <li><a
                        href='#mpeInstrument#processMidiMessage'
                        class='regular pre-open code'>
                        #processMidiMessage
                      </a></li>
                      
                      <li><a
                        href='#mpeInstrument#subscribe'
                        class='regular pre-open code'>
                        #subscribe
                      </a></li>
                      
                    </ul>
                  
                  
                </div>
                
                </li>
              
                
                <li class="mt1">
                  <a
                    href='#FAQs'
                    class="block bold black caps">
                    FAQs
                  </a>
                
                </li>
              
            </ul>
          </div>
          
        </div>
      </div>
      
      <div class='fix-margin-3'>
        <div class='px2'>
          <div id='demo'>
            <div class='tab-wrapper'>
              <div class='visualizer-wrapper'>
                <video id='mpe-video' class='visualizer' src='https://d30pueezughrda.cloudfront.net/mpe.js/mpe-demo.mp4' muted autoplay loop width='220' height='260'></video>
              </div>
              <pre class='tab-child' id='midi-input'></pre>
            </div>
            <div class='tab-wrapper'>
              <div id='mpe-visualizer-wrapper' class='visualizer-wrapper'>
                <canvas class='visualizer' id='mpe-visualizer'></canvas>
              </div>
              <pre class='tab-child' id='mpe-output'></pre>
            </div>
          </div>
          <div class='mt4 mb1 top'>
            <h2 class='library-description pb1 quiet inline-block'>
              Next generation MIDI for the web
            </h2>
          </div>
          
            
              <div class='mt-top-not'><section class='note mb1'>

  <h2 id='Installation' class='bold black caps anchor'>
    Installation
  </h2>

  
    <p>To install the latest version of mpe.js: <pre class='p1 mb1'>npm install --save mpe</pre></p>
<p>To use without a package manager: <pre class='p1 mb1'>&#x3C;script src=&#x27;//unpkg.com/mpe@1.0.0/lib/mpe.min.js&#x27;&#x3E;&#x3C;/script&#x3E;</pre></p>

  
</section>
</div>
            
          
            
              <div class='mt-top-not'><section class='note mb1'>

  <h2 id='Quick start' class='bold black caps anchor'>
    Quick start
  </h2>

  
    <p> Once installed from npm, mpe.js can be used in any of these ways.</p>
<ul>
<li>ES2015 module (recommended) <pre class='p1 mb1'>import mpeInstrument from &#x27;mpe&#x27;;</pre></li>
<li>Script tag <pre class='p1 mb1'>&#x3C;script src=&#x27;path/to/mpe/lib/mpe.min.js&#x27;&#x3E;&#x3C;/script&#x3E;</pre>
<small><em>Note</em>: Using <code>lib/mpe.min.js</code> or <code>lib/mpe.min.js</code> via a script tag will assign module contents to <code>window.mpe</code>.</small></li>
</ul>

  
</section>
</div>
            
          
            
              <div class='mt-top-not'><section class='note mb1'>

  <h2 id='API' class='bold black caps anchor'>
    API
  </h2>

  
</section>
</div>
            
          
            
              <section class='fill-white pt2 px2 stroke-light rounded'>

  
    <h2 class='clearfix anchor mb2 black' id='mpeInstrument'>
      <span class='left code'>
        mpeInstrument
      </span><!--
      --><span class="left quiet code">
        (options)
      </span>
      
        <a class='right round small' href='https://github.com/WeAreROLI/mpejs/blob/1d97625bec5961c29ec83b903f9829613b41b5ba/./src/mpeInstrument/index.js#L40-L169'>
          <span>./src/mpeInstrument/index.js</span>
        </a>
      
    </h2>
  


  <div class='section-contents mt1 '>
      <p>Creates a new instrument instance for processing MPE data</p>


      

      
      
      
      
      

      
        <div class='quiet mt1 prose-big'>Parameters</div>
        <div class='prose'>
          
            <div class='space-bottom0'>
              <div>
                <span class='code'>options</span><code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code> 
              </div>
              
              <table class='mt1 mb2 fixed-table'>
                <colgroup>
                  <col width='30%' />
                  <col width='70%' />
                </colgroup>
                <thead>
                  <tr class='fill-light'>
                    <td>Name</td>
                    <td>Description</td>
                  </tr>
                </thead>
                <tbody class='mt1'>
                  
                    <tr>
                      <td class='break-word'><span class='code'>options.log</span>
                      
                        (default <code>false</code>)
                      </td>
                      <td class='break-word'><span>Log instrument state to the console on
change
</span></td>
                    </tr>
                  
                    <tr>
                      <td class='break-word'><span class='code'>options.normalize</span>
                      
                        (default <code>false</code>)
                      </td>
                      <td class='break-word'><span>For all notes, remap 
<code>timbre</code>
,

<code>noteOnVelocity</code>
, 
<code>noteOffVelocity</code>
 and 
<code>pressure</code>
 between 0 and 1, remap

<code>pitchBend</code>
 between -1 and 1
</span></td>
                    </tr>
                  
                    <tr>
                      <td class='break-word'><span class='code'>options.pitch</span>
                      
                        (default <code>false</code>)
                      </td>
                      <td class='break-word'><span>Adds a 
<code>pitch</code>
 property to all notes:
uses scientific notation eg. 
<code>C4</code>
 when 
<code>true</code>
 or 
<code>&#x27;scientific&#x27;</code>
, uses
Helmholtz notation eg. 
<code>c&#x27;</code>
 when set to 
<code>&#x27;helmholtz&#x27;</code>
</span></td>
                    </tr>
                  
                    <tr>
                      <td class='break-word'><span class='code'>options.pitchBendRange</span>
                      
                        (default <code>48</code>)
                      </td>
                      <td class='break-word'><span>Converts 
<code>pitchBend</code>
 to the
range specified, overriding 
<code>normalize</code>
 if both are set
</span></td>
                    </tr>
                  
                </tbody>
              </table>
              
            </div>
          
        </div>
      

      

      
        
          <div class='quiet mt1 prose-big'>Returns</div>
          <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code>
            Instance representing an MPE compatible instrument

          
        
      

      

      
        <div class='quiet mt1 prose-big'>Example</div>
        
          
          <pre class='p1 overflow-auto rounded'><span class="hljs-keyword">import</span> mpeInstrument <span class="hljs-keyword">from</span> <span class="hljs-string">'mpe'</span>;

<span class="hljs-comment">// Define `instrument` as an instance of `mpeInstrument`</span>
<span class="hljs-keyword">const</span> instrument = mpeInstrument();

<span class="hljs-comment">// 1) Request MIDI device access from the Web MIDI API</span>
<span class="hljs-comment">// 2) Take the first `MIDIInput` from the available MIDI `inputMap`</span>
<span class="hljs-comment">// 3) Send input messages from this input to `instrument`</span>
navigator.requestMIDIAccess().then(access =&gt; {
  <span class="hljs-keyword">const</span> midiInput = access.inputMap.values().next();
  midiInput.addEventListener(
    <span class="hljs-string">'midimessage'</span>,
    (event) =&gt; instrument.processMidiMessage(event.data)
  );
});</pre>
        
      

      

      
        <div class='quiet mt1 prose-big'>Instance Members</div>
        <div class="clearfix">
  
    <div class='keyline-bottom stroke-light pt1 px1 mb1 rounded'>
      <div class='anchor' id='mpeInstrument#activeNotes'></div>
      <div class="clearfix pointer toggle-sibling">
        <div class="pad1y mb1 contain pointer">
            <a class='icon right pad1y dark-link caret-right'>▾</a>
            <span class='code truncate'>activeNotes</span><!--
         --><span class='quiet code space-right2'>()</span>
        </div>
      </div>
      <div class="clearfix hidden toggle-target">
        <section class=''>

  


  <div class='section-contents mt1 pl3 mb2'>
      <p>Lists active notes of the <code>mpeInstrument</code> instance</p>


      

      
      
      
      
      

      

      

      
        
          <div class='quiet mt1 prose-big'>Returns</div>
          <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a></code>
            Active note objects

          
        
      

      

      
        <div class='quiet mt1 prose-big'>Example</div>
        
          
          <pre class='p1 overflow-auto rounded'><span class="hljs-keyword">import</span> mpeInstrument <span class="hljs-keyword">from</span> <span class="hljs-string">'mpe'</span>;

<span class="hljs-keyword">const</span> instrument = mpeInstrument();

instrument.activeNotes();
<span class="hljs-comment">// =&gt; []</span>

instrument.processMidiMessage([<span class="hljs-number">145</span>, <span class="hljs-number">60</span>, <span class="hljs-number">127</span>]);
instrument.activeNotes();
<span class="hljs-comment">// =&gt; [ { noteNumber: 60,</span>
<span class="hljs-comment">//        channel: 2,</span>
<span class="hljs-comment">//        noteOnVelocity: 1,</span>
<span class="hljs-comment">//        pitchBend: 0,</span>
<span class="hljs-comment">//        timbre: 0.5,</span>
<span class="hljs-comment">//        pressure: 0 } ]</span></pre>
        
      

      

      

      
  </div>
</section>

      </div>
    </div>
  
    <div class='keyline-bottom stroke-light pt1 px1 mb1 rounded'>
      <div class='anchor' id='mpeInstrument#clear'></div>
      <div class="clearfix pointer toggle-sibling">
        <div class="pad1y mb1 contain pointer">
            <a class='icon right pad1y dark-link caret-right'>▾</a>
            <span class='code truncate'>clear</span><!--
         --><span class='quiet code space-right2'></span>
        </div>
      </div>
      <div class="clearfix hidden toggle-target">
        <section class=''>

  


  <div class='section-contents mt1 pl3 mb2'>
      <p>Clears all active notes</p>


      

      
      
      
      
      

      

      

      
        
          <div class='quiet mt1 prose-big'>Returns</div>
          <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined">undefined</a></code>
            

          
        
      

      

      
        <div class='quiet mt1 prose-big'>Example</div>
        
          
          <pre class='p1 overflow-auto rounded'><span class="hljs-keyword">import</span> mpeInstrument <span class="hljs-keyword">from</span> <span class="hljs-string">'mpe'</span>;

<span class="hljs-keyword">const</span> instrument = mpeInstrument();

instrument.activeNotes();
<span class="hljs-comment">// =&gt; []</span>

instrument.processMidiMessage([<span class="hljs-number">145</span>, <span class="hljs-number">60</span>, <span class="hljs-number">127</span>]);
instrument.activeNotes();
<span class="hljs-comment">// =&gt; [ { noteNumber: 60,</span>
<span class="hljs-comment">//        channel: 2,</span>
<span class="hljs-comment">//        noteOnVelocity: 1,</span>
<span class="hljs-comment">//        pitchBend: 0,</span>
<span class="hljs-comment">//        timbre: 0.5,</span>
<span class="hljs-comment">//        pressure: 0 } ]</span>

instrument.clear();
instrument.activeNotes()
<span class="hljs-comment">// =&gt; []</span></pre>
        
      

      

      

      
  </div>
</section>

      </div>
    </div>
  
    <div class='keyline-bottom stroke-light pt1 px1 mb1 rounded'>
      <div class='anchor' id='mpeInstrument#processMidiMessage'></div>
      <div class="clearfix pointer toggle-sibling">
        <div class="pad1y mb1 contain pointer">
            <a class='icon right pad1y dark-link caret-right'>▾</a>
            <span class='code truncate'>processMidiMessage</span><!--
         --><span class='quiet code space-right2'></span>
        </div>
      </div>
      <div class="clearfix hidden toggle-target">
        <section class=''>

  


  <div class='section-contents mt1 pl3 mb2'>
      <p>Reads an MPE message and updates <code>mpeInstrument</code> state</p>


      

      
      
      
      
      

      
        <div class='quiet mt1 prose-big'>Parameters</div>
        <div class='prose'>
          
            <div class='space-bottom0'>
              <div>
                <span class='code'>midiMessage</span><code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">Uint8Array</a></code> An MPE MIDI message

              </div>
              
            </div>
          
        </div>
      

      

      
        
          <div class='quiet mt1 prose-big'>Returns</div>
          <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined">undefined</a></code>
            

          
        
      

      

      
        <div class='quiet mt1 prose-big'>Example</div>
        
          
          <pre class='p1 overflow-auto rounded'><span class="hljs-keyword">import</span> mpeInstrument <span class="hljs-keyword">from</span> <span class="hljs-string">'mpe'</span>;

<span class="hljs-keyword">const</span> instrument = mpeInstrument();

<span class="hljs-comment">// Trigger a note on, channel 2, middle C, max velocity</span>
instrument.processMidiMessage([<span class="hljs-number">145</span>, <span class="hljs-number">60</span>, <span class="hljs-number">127</span>]);</pre>
        
      

      

      

      
  </div>
</section>

      </div>
    </div>
  
    <div class='keyline-bottom stroke-light pt1 px1 mb1 rounded'>
      <div class='anchor' id='mpeInstrument#subscribe'></div>
      <div class="clearfix pointer toggle-sibling">
        <div class="pad1y mb1 contain pointer">
            <a class='icon right pad1y dark-link caret-right'>▾</a>
            <span class='code truncate'>subscribe</span><!--
         --><span class='quiet code space-right2'></span>
        </div>
      </div>
      <div class="clearfix hidden toggle-target">
        <section class=''>

  


  <div class='section-contents mt1 pl3 mb2'>
      <p>Subscribes a callback to changes to the instance&#x27;s active notes</p>


      

      
      
      
      
      

      
        <div class='quiet mt1 prose-big'>Parameters</div>
        <div class='prose'>
          
            <div class='space-bottom0'>
              <div>
                <span class='code'>callback</span><code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function">function</a></code> Callback for active note changes

              </div>
              
            </div>
          
        </div>
      

      

      
        
          <div class='quiet mt1 prose-big'>Returns</div>
          <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function">function</a></code>
            Unsubscribe the callback

          
        
      

      

      
        <div class='quiet mt1 prose-big'>Example</div>
        
          
          <pre class='p1 overflow-auto rounded'><span class="hljs-keyword">import</span> mpeInstrument <span class="hljs-keyword">from</span> <span class="hljs-string">'mpe'</span>;

<span class="hljs-keyword">const</span> instrument = mpeInstrument();

<span class="hljs-comment">// Log `activeNotes` values to the console on change</span>
instrument.subscribe(<span class="hljs-built_in">console</span>.log);</pre>
        
      

      

      

      
  </div>
</section>

      </div>
    </div>
  
</div>

      

      
  </div>
</section>

            
          
            
              <div class='mt-top-not'><section class='note mb1'>

  <h2 id='FAQs' class='bold black caps anchor'>
    FAQs
  </h2>

  
    <h3>What is MPE?</h3>
<p>MPE stands for “MIDI Polyphonic Expression” and is an extension of MIDI 1.0.</p>
<h3>How does MPE differ from MIDI 1.0?</h3>
<p>MPE allows individual notes to have independent pitch bend values whereas MIDI 1.0 only allows these to be set globally for all voices at once.</p>
<p>Instruments following the <a href="https://docs.google.com/document/d/1vpjxoPHw82X3xyNvE6_hsDeL86vloNQZC83NHD8edow/edit">MPE proposed specification</a> assign conventional note on/off messages into “note channels”.</p>
<h3>What MPE controllers and MPE compatible software is currently available?</h3>
<p>ROLI’s <a href="https://roli.com/products/seaboard">Seaboard</a> and <a href="https://roli.com/products/blocks">BLOCKS</a> controllers, the Haken Continuum and the Linnstrument are all MPE compatible.</p>
<p>The MPE working group is supported by ROLI, Apple, Bitwig, Moog, Haken and Roger Linn Design. MPE is currently implemented in Logic X, Bitwig Studio and Cubase, as well as ROLI’s Equator and NOISE software synths.</p>
<h3>How does mpe.js help in building an MPE compatible web app?</h3>
<p>An mpe.js <a href="#mpeInstrument"><code>mpeInstrument</code></a> instance accepts MPE messages as input and returns a standardized representation of the current touch state described. MPE messages are reduced to a sorted array of “active note” objects with named properties that update in response to new input messages.</p>
<p>Without mpe.js, a developer would need to process individual MPE messages, apply bitwise operations to derive the message&#x27;s meaning (with reference to the <a href="https://docs.google.com/document/d/1vpjxoPHw82X3xyNvE6_hsDeL86vloNQZC83NHD8edow/edit">MPE proposed specification</a>) and then apply the derived instruction to a manually collected representation of the instrument state.</p>
<h3>What&#x27;s the difference between an MPE message and a standard MIDI message?</h3>
<p>None. For the purpose of backwards compatibility, MPE only changes the convention by which messages are interpretted rather than MIDI communication protocol itself. An MPE message is a 1–3 byte message that can be sent and received in all the same ways.</p>
<h3>Can I use mpe.js with MIDI 1.0?</h3>
<p>Yes. Whilst certain parameters won&#x27;t be relevant – <code>timbre</code>, for example – mpe.js&#x27;s touch state representation is fully backwards compatible with MIDI 1.0 instruments.</p>
<h3>Do I have to use this with the Web MIDI API?</h3>
<p>No. mpe.js can be used to simplify reading recorded MPE data in the browser without depending on <a href="https://webaudio.github.io/web-midi-api/">Web MIDI API</a> for live input. It can also be used in node.js, either for offline usage, or processing live input via I/O libraries such as <a href="https://github.com/justinlatimer/node-midi">node-midi</a>.</p>
<h3>Why would I build a synth/visualisation/music web application using browsers or node.js?</h3>
<p>We&#x27;ve found JavaScript tools to be a convenient medium for prototyping and see potential beyond that for the future. Whilst there is cause for excitement in the area, your mileage may vary.</p>
<h3>Are there tools to use MPE in other programming languages?</h3>
<p>Yes! A C++ implementation is included in <a href="https://juce.com">JUCE</a>.</p>

  
</section>
</div>
            
          
        </div>
      </div>
    </div>
  </div>
  <script src='assets/anchor.js'></script>
  <script src='assets/site.js'></script>
  <script>
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
  </script>
  <!-- demo deps -->
  <script src='assets/mpe.min.js'></script>
  <script src='assets/waa-clock.js'></script>
  <!-- demo -->
  <script src='assets/mpe-demo.js'></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-74377415-2', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
